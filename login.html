<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Login | Learn with GPT</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
body { font-family: Arial,sans-serif; background:#e0f2ff; display:flex; justify-content:center; align-items:center; height:100vh; margin:0; }
.container { background:white; padding:30px 40px; border-radius:12px; box-shadow:0 4px 12px rgba(0,0,0,0.2); width:100%; max-width:400px; }
h2 { text-align:center; color:#0B3D91; margin-bottom:20px; }
input { width:100%; padding:10px; margin:10px 0; border-radius:6px; border:1px solid #ccc; font-size:16px; }
button { width:100%; padding:12px; background:#0B3D91; color:white; font-size:16px; border:none; border-radius:6px; cursor:pointer; margin-top:10px; }
button:hover { background:#094080; }
.message { text-align:center; margin-top:10px; color:red; }
</style>
</head>

<body>

<div class="container">
    <h2>Login</h2>
    <form id="loginForm">
        <input type="email" id="email" placeholder="Email" required>
        <input type="password" id="password" placeholder="Password" required>
        <button type="submit">Login</button>
        <div class="message" id="message"></div>
    </form>
    <p style="text-align:center; margin-top:15px;">Don't have an account? <a href="signup.html">Sign Up</a></p>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-app.js";
import { getAuth, signInWithEmailAndPassword } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-auth.js";
import { getFirestore, doc, getDoc, Timestamp } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore.js";

const firebaseConfig = {
    apiKey: "AIzaSyCvL_D8wRVC3hS0mEvTt2J_D-LG7wFFpx0",
    authDomain: "environmentalgpt-4974a.firebaseapp.com",
    projectId: "environmentalgpt-4974a",
    storageBucket: "environmentalgpt-4974a.firebasestorage.app",
    messagingSenderId: "947094029861",
    appId: "1:947094029861:web:ffa5c1ad4abff06d6e21cc",
    measurementId: "G-36T3Y37DS4"
};

const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getFirestore(app);

const loginForm = document.getElementById("loginForm");
const messageEl = document.getElementById("message");

loginForm.addEventListener("submit", async e=>{
    e.preventDefault();
    const email = document.getElementById("email").value.trim();
    const password = document.getElementById("password").value;

    messageEl.textContent = "";

    try {
        const userCredential = await signInWithEmailAndPassword(auth,email,password);
        const user = userCredential.user;

        // Check countdown
        const snap = await getDoc(doc(db,"users",user.uid));
        if(!snap.exists()) throw new Error("User data not found");
        const countdownEnd = snap.data().countdownEnd.toDate();
        if(countdownEnd < new Date()) {
            messageEl.textContent = "Your access has expired!";
            await auth.signOut();
            return;
        }

        // Redirect to dashboard
        window.location.href = "dashboard.html";

    } catch(err) {
        messageEl.textContent = err.message;
    }
});
</script>

</body>
</html>